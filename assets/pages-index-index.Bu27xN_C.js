import{o as t,c as e,w as s,a,F as o,r as l,n as i,b as n,d as c,t as d,e as r,i as f,S as u,f as h,g as p}from"./index-CRY8WhL-.js";const m=(t,e)=>{const s=t.__vccOpts||t;for(const[a,o]of e)s[a]=o;return s};const g=m({name:"zero-timeline",props:{dataList:{type:Array,default:()=>[]},showLeft:{type:Boolean,default:!0},leftWidth:{type:String,default:"150rpx"},gap:{type:String,default:"20rpx"}},data:()=>({}),methods:{herescrolltolower(){this.$emit("myscrolltolower")},gotoPage(t){window.location.href="siyuan://blocks/"+t.id}}},[["render",function(h,p,m,g,L,T){const _=f,y=u;return t(),e(y,{class:"zero-timeline","scroll-y":"",onScrolltolower:p[0]||(p[0]=t=>T.herescrolltolower())},{default:s((()=>[(t(!0),a(o,null,l(m.dataList,((a,o)=>(t(),e(_,{key:o,class:"item",style:i({"--color":a.color||"#0396FF","--bgcolor":a.color?a.color+"1a":"#0396FF1a","--gap":m.gap,"--left":m.leftWidth})},{default:s((()=>[m.showLeft?(t(),e(_,{key:0,class:"left"},{default:s((()=>[n(_,{class:"time"},{default:s((()=>[c(d(a.leftTime),1)])),_:2},1024),n(_,{class:"content"},{default:s((()=>[n(_,{class:"title"},{default:s((()=>[c(d(a.leftTitle),1)])),_:2},1024),n(_,{class:"sub"},{default:s((()=>[c(d(a.leftContent),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):r("",!0),n(_,{class:"line"},{default:s((()=>[n(_,{class:"dot"})])),_:1}),n(_,{class:"right",onClick:t=>T.gotoPage(a)},{default:s((()=>[n(_,{class:"time"},{default:s((()=>[c(d(a.time),1)])),_:2},1024),n(_,{class:"content"},{default:s((()=>[n(_,{class:"title"},{default:s((()=>[c(d(a.title),1)])),_:2},1024),n(_,{class:"sub"},{default:s((()=>[c(d(a.content),1)])),_:2},1024),n(_,{class:"tips"},{default:s((()=>[c(d(a.sub),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["style"])))),128))])),_:1})}],["__scopeId","data-v-e7ee6387"]]);function L(t,e,s){h({url:"/api/query/sql",method:"POST",data:{stmt:"SELECT * FROM blocks WHERE type = 'd' ORDER BY updated DESC LIMIT "+e+" OFFSET "+t},header:{Authorization:"Token "},success:s})}function T(t,e,s){var a=e[t].id,o=e[t].updated,l=`select * from blocks where (root_id = '${a}') and type = 'p'`;l+=" And updated >= '"+o.slice(0,8)+"000000' And updated <= '"+o.slice(0,8)+"235959'",h({url:"/api/query/sql",method:"POST",data:{stmt:l},header:{Authorization:"Token "},success:a=>{const o=a.data.data;var l="";for(const t of o)if(t.content.length>0){var i=t.content;i.length>s&&(i=i.slice(0,s)+"..."),l+=i+"\n"}e[t].content=l}})}const _=m({data:()=>({dataList:[],lengthLimit:15,noteBooks:new Map,seenLeftTimes:new Map,colorIndex:0,colors:["#11998e","#5da748","#ff55ff"]}),created(){this.init()},methods:{init(){var t;t=this.noteBooks,h({url:"/api/notebook/lsNotebooks",method:"POST",header:{Authorization:"Token "},success:e=>{e.data.data.notebooks.forEach((e=>{t.set(e.id,e.name)}))}}),L(0,15,this.dealresult)},loadMore(){L(this.dataList.length,15,this.dealresult)},dealresult(t){const e=t.data.data.map(((t,e)=>{const s=t.updated,a=s.slice(0,4),o=s.slice(4,6),l=s.slice(6,8),i=s.slice(8,10),n=s.slice(10,12);s.slice(12,14);const c=`${a}年\n${o}月${l}日`;var d,r,f;return this.seenLeftTimes.has(c)?(this.seenLeftTimes.set(c,this.seenLeftTimes.get(c)+1),d="",r="第"+this.seenLeftTimes.get(c),f=`${i}:${n}`):(this.seenLeftTimes.set(c,1),d=c,r="第"+this.seenLeftTimes.get(c),f=`${i}:${n}`),{id:t.id,updated:t.updated,title:t.content,content:"",sub:this.noteBooks.get(t.box)+t.hpath,leftTime:d,leftTitle:r,leftContent:f,color:this.colors[this.colorIndex++%this.colors.length]}}));this.dataList=this.dataList.concat(e),function(t,e){for(let s=0;s<t.length;s++)T(s,t,e)}(this.dataList,this.lengthLimit)}}},[["render",function(a,o,l,i,c,d){const r=(u=p("zero-timeline"),h=g,"string"==typeof u?h:u);var u,h;const m=f;return t(),e(m,{class:"container"},{default:s((()=>[n(r,{dataList:c.dataList,gap:"30px","scroll-y":"",onMyscrolltolower:o[0]||(o[0]=t=>d.loadMore())},null,8,["dataList"])])),_:1})}]]);export{_ as default};
